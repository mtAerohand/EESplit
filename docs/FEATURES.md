# EESplit 機能仕様書

## 概要

原神の精鋭狩り（Elite Enemy）RTA用タイマーアプリケーション「EESplit」の機能仕様書です。

**精鋭狩りRTA**: 原神において精鋭（Elite Enemy）に類別される敵を400体倒すまでのタイムアタック

## 実装する機能

### 機能1: 区間ごとに精鋭数を設定する機能

#### 概要
各スプリット（区間）で倒す精鋭の数を設定できる機能

#### 仕様
- **設定方法**: UI上で設定
- **区間の定義**: LiveSplitの「スプリット」＝「区間」
- **精鋭数の扱い**: 事前の予定数のみを設定
- **合計の表示**: 全区間の精鋭数合計を表示する（チェック/警告は不要）

#### 実装詳細
- スプリット編集UI に「精鋭数」入力フィールドを追加
- 全スプリットの精鋭数合計を画面上部に表示（例：「合計: 400体」）

---

### 機能2: 区間ごとに精鋭一体あたりの平均討伐秒数の算出と表示

#### 概要
各区間で精鋭1体を倒すのにかかっている平均秒数を計算・表示

#### 仕様
- **計算式**: `区間タイム ÷ 設定した精鋭数`
- **表示タイミング**: 区間終了後のみ
- **表示場所**: 各区間の行に追加列として表示
- **比較表示**: 今回は実装しない（将来的な拡張として検討）

#### 実装詳細
- スプリット一覧に「平均秒/体」列を追加
- 区間完了時に計算して表示
- 表示形式: 「X.X秒/体」（小数点1桁）

---

### 機能3: 討伐の平均秒数が悪い区間の行の色を変える

#### 概要
パフォーマンスが悪い区間を視覚的に識別できるようにする

#### 仕様
- **閾値オプション**: 排他的（以下のいずれか1つを選択）
  1. 下位n%
  2. 下位n位
  3. 討伐平均秒数（絶対値）
- **閾値の設定方法**: UI/設定画面で設定
- **色の種類**: 固定色
- **判定基準**: 現在のラン内で判定（過去のベストとの比較はしない）

#### 実装詳細
- 設定画面に閾値設定UIを追加
  - ラジオボタンで閾値オプションを選択
  - 選択したオプションに応じた数値入力フィールド
- 判定ロジック:
  - **下位n%**: 現在のラン内の全区間中の下位n%に該当する区間
  - **下位n位**: 現在のラン内で平均秒数が下位n位の区間
  - **討伐平均秒数**: 指定した秒数以上の区間（例：10秒/体以上）
- 色: 赤系の固定色（例：#ff4444 背景、#ffffff テキスト）

---

### 機能4: 精鋭数カウンター表示

#### 概要
現在までに倒した精鋭数の合計をリアルタイムで表示

#### 仕様
- **表示形式**: 「現在の合計/全区間の合計」（例：「125/400体」）
- **計算方法**: 完了した区間に設定された精鋭数の合計
- **更新タイミング**: 区間完了時にリアルタイムで更新

#### 実装詳細
- メイン画面上部に大きく表示
- スプリット完了時に自動更新
- 視認性の高いフォントサイズ・色で表示

---

## データ管理

### 精鋭の種類
- 敵の種類は区別しない（すべて「精鋭」として一律に扱う）

### 履歴管理
- LiveSplitの標準の保存機能を今回の改修に合わせて拡張
- 精鋭数の情報もスプリット情報と一緒に保存
- 既存のファイル形式を拡張（後方互換性を考慮）

### インポート/エクスポート
- 特別な共有機能は追加しない
- 標準の保存/読み込み機能を使用
- ファイル形式: 既存のLiveSplit形式を拡張

---

## 将来の拡張要素

以下の機能は今回の実装範囲外だが、将来的に検討する：

### ペース表示機能
- 「このペースだと最終タイムは○分」のような予測表示
- 現在のペースから最終タイムを予測

### 比較表示機能
- ベストタイムの平均秒数も表示
- デルタ（差分）表示（例：ベストより+1.2秒/体）

### 到達判定
- 400体達成時の特別な表示/通知（現時点では不要）

---

## 非機能要件

### パフォーマンス
- 原神と同時起動することを想定
- リソース消費を最小限に抑える
- 計算処理は軽量に保つ

### UI/UX
- 日本語UIを標準とする
- 原神のテーマカラーに合わせたデザイン（将来的に）
- 視認性の高い表示

---

## 技術的な注意事項

### データ構造
- スプリット情報に `elite_count: number` フィールドを追加
- 設定情報に閾値設定を保存する構造を追加

### 計算ロジック
- 精鋭数が0の場合は平均秒数を「N/A」と表示
- 区間タイムが0の場合も「N/A」と表示

### 互換性
- 既存のLiveSplitファイルを読み込んだ場合、精鋭数はデフォルトで0とする
- 精鋭数が設定されていないスプリットは平均秒数を表示しない
